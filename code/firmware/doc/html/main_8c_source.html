<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>Bachelorarbeit: Frequenzmessung: main.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Bachelorarbeit: Frequenzmessung
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('main_8c_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">main.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="main_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*-</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * Copyright (c) 2013, mozgan.</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * All Rights Reserved with BSD License.</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * Read LICENSE file.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> *      @(#) main.c             TU Wien 19.08.2013</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> *  $Id: main.c,v 0.5 19.08.2013 15:20:15 mozgan Exp $</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="preprocessor">#include &lt;string.h&gt;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="preprocessor">#include &lt;avr/io.h&gt;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &lt;util/delay.h&gt;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="common_8h.html">include/common.h</a>&gt;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="freq_8h.html">board/freq.h</a>&gt;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="buffer_8h.html">lib/buffer.h</a>&gt;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="leds_8h.html">driver/leds.h</a>&gt;</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="enc28j60_8h.html">device/enc28j60.h</a>&gt;</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="net_8h.html">driver/net.h</a>&gt;</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="icp_8h.html">driver/icp.h</a>&gt;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div>
<div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="main_8c.html#a6821bafc3c88dfb2e433a095df9940c6">   43</a></span>&#160;<span class="preprocessor">#define     BUF_SIZE    150</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div>
<div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="main_8c.html#aef549d19c508d258c21e95059b300d13">   45</a></span>&#160;<span class="keyword">static</span> uint8_t <a class="code" href="main_8c.html#aef549d19c508d258c21e95059b300d13">buf</a>[<a class="code" href="main_8c.html#a6821bafc3c88dfb2e433a095df9940c6">BUF_SIZE</a>];</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="main_8c.html#ae0177d7710b28f95720d54e2b1d37d65">   47</a></span>&#160;uint8_t <a class="code" href="main_8c.html#ae0177d7710b28f95720d54e2b1d37d65">mymac</a>[6] = {0xab,0xbc,0x6f,0x55,0x1c,0xc2};</div>
<div class="line"><a name="l00048"></a><span class="lineno"><a class="line" href="main_8c.html#a60983d0ff040975723414a8f21375c77">   48</a></span>&#160;uint8_t <a class="code" href="main_8c.html#a60983d0ff040975723414a8f21375c77">myip</a>[4] = {192, 168, 0, 3};</div>
<div class="line"><a name="l00049"></a><span class="lineno"><a class="line" href="main_8c.html#a2a1db0f1bf946876695219e06137df07">   49</a></span>&#160;uint16_t <a class="code" href="main_8c.html#a2a1db0f1bf946876695219e06137df07">myport</a> = 1200;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div>
<div class="line"><a name="l00051"></a><span class="lineno"><a class="line" href="main_8c.html#a1ec087735cb1d1e6da0c0a04fff747ba">   51</a></span>&#160;<span class="keyword">volatile</span> uint16_t <a class="code" href="main_8c.html#a1ec087735cb1d1e6da0c0a04fff747ba">plen</a>;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;</div>
<div class="line"><a name="l00053"></a><span class="lineno"><a class="line" href="main_8c.html#ae4e727681d08ae8c9618bb026716a532">   53</a></span>&#160;<span class="keyword">volatile</span> uint16_t <span class="keyword">new</span>, <a class="code" href="main_8c.html#ae4e727681d08ae8c9618bb026716a532">old</a>;</div>
<div class="line"><a name="l00054"></a><span class="lineno"><a class="line" href="main_8c.html#ace59d817931830cd94f04ac3f853bb76">   54</a></span>&#160;<span class="keyword">volatile</span> uint16_t <a class="code" href="main_8c.html#ace59d817931830cd94f04ac3f853bb76">diff</a>;</div>
<div class="line"><a name="l00055"></a><span class="lineno"><a class="line" href="main_8c.html#a74796ad69e9a5ee4a0448582ba5b1bb7">   55</a></span>&#160;<span class="keyword">volatile</span> <span class="keywordtype">float</span> <a class="code" href="main_8c.html#a74796ad69e9a5ee4a0448582ba5b1bb7">freq</a>;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;</div>
<div class="line"><a name="l00057"></a><span class="lineno"><a class="line" href="main_8c.html#a602b7b139bc6244cb09fedcdbb06e85e">   57</a></span>&#160;<span class="keyword">volatile</span> <span class="keywordtype">int</span> <a class="code" href="main_8c.html#a602b7b139bc6244cb09fedcdbb06e85e">snd</a> = 0;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="keywordtype">void</span></div>
<div class="line"><a name="l00065"></a><span class="lineno"><a class="line" href="main_8c.html#aedb0558a93e7ad957d3186ba04578ca0">   65</a></span>&#160;<a class="code" href="main_8c.html#aedb0558a93e7ad957d3186ba04578ca0">trigger</a>(uint16_t icr)</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;{</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <a class="code" href="main_8c.html#ae4e727681d08ae8c9618bb026716a532">old</a> = <span class="keyword">new</span>;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        <span class="keyword">new</span> = icr;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        <span class="keywordflow">if</span> (<span class="keyword">new</span> &gt; <a class="code" href="main_8c.html#ae4e727681d08ae8c9618bb026716a532">old</a>) {</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                <a class="code" href="buffer_8c.html#a7760b3d8ac8ebcf70f3ec2b91efb6dc5">buffer_write</a>((<span class="keyword">new</span> - <a class="code" href="main_8c.html#ae4e727681d08ae8c9618bb026716a532">old</a>));</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="main_8c.html#a602b7b139bc6244cb09fedcdbb06e85e">snd</a> &lt; <a class="code" href="buffer_8h.html#a05b49c662c073f89e86804f7856622a0">LEN</a>)</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                        <a class="code" href="main_8c.html#a602b7b139bc6244cb09fedcdbb06e85e">snd</a>++;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        }</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        <span class="comment">/* debug */</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="preprocessor">#ifdef DEBUG</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        <a class="code" href="leds_8c.html#a15aeb6fd48b8cbb5fb0c0380f88fa676">led_toggle</a>(0);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;}</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="keywordtype">int</span></div>
<div class="line"><a name="l00089"></a><span class="lineno"><a class="line" href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe">   89</a></span>&#160;<a class="code" href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe">main</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;{</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <a class="code" href="buffer_8c.html#ae4a17adb1fbf755574c338b7d17a68e6">buffer_init</a>();      <span class="comment">/* initialize the buffer ring */</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <a class="code" href="leds_8c.html#a67cfc3137a465e560792490e81365254">leds_init</a>();        <span class="comment">/* leds for debuging */</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <span class="comment">/* initialize the ENC28J60 device with the physical mac address */</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <a class="code" href="enc28j60_8h.html#a9c0a8d055c8531d4ca1aa8e691acf70a">enc_init</a>(<a class="code" href="main_8c.html#ae0177d7710b28f95720d54e2b1d37d65">mymac</a>);        </div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        _delay_ms(100);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        <a class="code" href="enc28j60_8h.html#aa75a4325284e67324bcee6b18f882b54">enc_init_phy</a>();</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;        <span class="comment">/* initialize the ip address for the given mac address */</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;        <a class="code" href="net_8c.html#a044265f0081346e76e9686ec54badf5b">net_init</a>(<a class="code" href="main_8c.html#ae0177d7710b28f95720d54e2b1d37d65">mymac</a>, <a class="code" href="main_8c.html#a60983d0ff040975723414a8f21375c77">myip</a>);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <span class="comment">/* initialize the input capture pin and the timer/counter1 for capturing */</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        <a class="code" href="icp_8c.html#a9aea3198ad5628ffd740d6dc46d0f640">icp_init</a>(<a class="code" href="main_8c.html#aedb0558a93e7ad957d3186ba04578ca0">trigger</a>);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;        <span class="comment">/* enable the interrupt routine */</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        sei();</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        <span class="keywordflow">while</span> (<a class="code" href="common_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>) {</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                <span class="comment">/* read a packet from ENC28J60 device */</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                <a class="code" href="main_8c.html#a1ec087735cb1d1e6da0c0a04fff747ba">plen</a> = <a class="code" href="enc28j60_8h.html#a955683da076de3f92da57d7d06951ae7">enc_recv_packet</a>(<a class="code" href="main_8c.html#a6821bafc3c88dfb2e433a095df9940c6">BUF_SIZE</a>, <a class="code" href="main_8c.html#aef549d19c508d258c21e95059b300d13">buf</a>);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="main_8c.html#a1ec087735cb1d1e6da0c0a04fff747ba">plen</a> == 0)</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                </div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="net_8c.html#a2e5cb2f2e4db612d3ac1262da515f20f">eth_arp</a>(<a class="code" href="main_8c.html#aef549d19c508d258c21e95059b300d13">buf</a>, <a class="code" href="main_8c.html#a1ec087735cb1d1e6da0c0a04fff747ba">plen</a>)) {</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                        <a class="code" href="net_8c.html#ad8c59c931bff8fe806ce7598efb6047c">arp_answer</a>(<a class="code" href="main_8c.html#aef549d19c508d258c21e95059b300d13">buf</a>, <a class="code" href="main_8c.html#a1ec087735cb1d1e6da0c0a04fff747ba">plen</a>);</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                }</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="net_8c.html#af0b4a02ade3a716c6b10ce1fc821770b">eth_ip</a>(<a class="code" href="main_8c.html#aef549d19c508d258c21e95059b300d13">buf</a>, <a class="code" href="main_8c.html#a1ec087735cb1d1e6da0c0a04fff747ba">plen</a>) == 0)</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                <span class="comment">/* if there is a ping, then send a pong */</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                <span class="keywordflow">if</span> ((<a class="code" href="main_8c.html#aef549d19c508d258c21e95059b300d13">buf</a>[<a class="code" href="net_8h.html#a94a24147ac9e4282e3dc3109916eceee">IP_PROTO_P</a>] == <a class="code" href="net_8h.html#a5ac4d574d1b2e5119c7ab8c2b74be434">IP_PROTO_ICMP_V</a>) &amp;&amp;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                     <a class="code" href="main_8c.html#aef549d19c508d258c21e95059b300d13">buf</a>[<a class="code" href="net_8h.html#af4d84ceabffe9baf6af2687d56657dfe">ICMP_TYPE_P</a>] == <a class="code" href="net_8h.html#a7759a689bdd28850817c7de8869d35c4">ICMP_REQUEST_V</a>) {</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                        <a class="code" href="net_8c.html#a4f72e5a5ef17368554a9b5368d05b5bd">echo_reply</a>(<a class="code" href="main_8c.html#aef549d19c508d258c21e95059b300d13">buf</a>, <a class="code" href="main_8c.html#a1ec087735cb1d1e6da0c0a04fff747ba">plen</a>);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                        <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                }</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                <span class="comment">/*</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">                 * if received a UDP protocol, as we waiting it,</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">                 * then send the frequency from ring buffer</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">                 */</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="main_8c.html#aef549d19c508d258c21e95059b300d13">buf</a>[<a class="code" href="net_8h.html#a94a24147ac9e4282e3dc3109916eceee">IP_PROTO_P</a>] == <a class="code" href="net_8h.html#af197bd006505ea01b4cafbf596916af7">IP_PROTO_UDP_V</a>) {</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                        <span class="keywordflow">if</span> (<a class="code" href="main_8c.html#a602b7b139bc6244cb09fedcdbb06e85e">snd</a> == <a class="code" href="buffer_8h.html#a05b49c662c073f89e86804f7856622a0">LEN</a>) {</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                                <span class="keywordtype">char</span> str[12];</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                                <span class="keyword">static</span> <span class="keywordtype">float</span> <a class="code" href="main_8c.html#ace59d817931830cd94f04ac3f853bb76">diff</a>;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                                diff = <a class="code" href="buffer_8c.html#ab4c57bf12ec39024ce3d6d56ad70abe9">buffer_medium</a>();</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                                <a class="code" href="main_8c.html#a74796ad69e9a5ee4a0448582ba5b1bb7">freq</a> = (float)<a class="code" href="atmega16_8h.html#a43bafb28b29491ec7f871319b5a3b2f8">F_CPU</a> / diff;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                                <a class="code" href="main_8c.html#a74796ad69e9a5ee4a0448582ba5b1bb7">freq</a> /= 256;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                                dtostrf((<span class="keywordtype">float</span>)<a class="code" href="main_8c.html#a74796ad69e9a5ee4a0448582ba5b1bb7">freq</a>, 12, 3, str);</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                                <a class="code" href="net_8c.html#a26c789f4ef67752529324ebba5ac51a1">udp_reply</a>(<a class="code" href="main_8c.html#aef549d19c508d258c21e95059b300d13">buf</a>, str, strlen(str), <a class="code" href="main_8c.html#a2a1db0f1bf946876695219e06137df07">myport</a>);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                        }</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                }</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        }</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;}</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div>
<div class="ttc" id="leds_8c_html_a67cfc3137a465e560792490e81365254"><div class="ttname"><a href="leds_8c.html#a67cfc3137a465e560792490e81365254">leds_init</a></div><div class="ttdeci">void leds_init(void)</div><div class="ttdoc">initialize all LEDs </div><div class="ttdef"><b>Definition:</b> <a href="leds_8c_source.html#l00033">leds.c:33</a></div></div>
<div class="ttc" id="buffer_8c_html_a7760b3d8ac8ebcf70f3ec2b91efb6dc5"><div class="ttname"><a href="buffer_8c.html#a7760b3d8ac8ebcf70f3ec2b91efb6dc5">buffer_write</a></div><div class="ttdeci">void buffer_write(uint16_t c)</div><div class="ttdoc">write the new data in ring buffer </div><div class="ttdef"><b>Definition:</b> <a href="buffer_8c_source.html#l00045">buffer.c:45</a></div></div>
<div class="ttc" id="buffer_8c_html_ab4c57bf12ec39024ce3d6d56ad70abe9"><div class="ttname"><a href="buffer_8c.html#ab4c57bf12ec39024ce3d6d56ad70abe9">buffer_medium</a></div><div class="ttdeci">float buffer_medium(void)</div><div class="ttdoc">calculate the medium of ring buffer </div><div class="ttdef"><b>Definition:</b> <a href="buffer_8c_source.html#l00059">buffer.c:59</a></div></div>
<div class="ttc" id="net_8h_html"><div class="ttname"><a href="net_8h.html">net.h</a></div><div class="ttdoc">header file for network communication </div></div>
<div class="ttc" id="net_8c_html_a044265f0081346e76e9686ec54badf5b"><div class="ttname"><a href="net_8c.html#a044265f0081346e76e9686ec54badf5b">net_init</a></div><div class="ttdeci">void net_init(uint8_t *mymac, uint8_t *myip)</div><div class="ttdoc">initialize the network </div><div class="ttdef"><b>Definition:</b> <a href="net_8c_source.html#l00043">net.c:43</a></div></div>
<div class="ttc" id="net_8h_html_af4d84ceabffe9baf6af2687d56657dfe"><div class="ttname"><a href="net_8h.html#af4d84ceabffe9baf6af2687d56657dfe">ICMP_TYPE_P</a></div><div class="ttdeci">#define ICMP_TYPE_P</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00159">net.h:159</a></div></div>
<div class="ttc" id="enc28j60_8h_html_aa75a4325284e67324bcee6b18f882b54"><div class="ttname"><a href="enc28j60_8h.html#aa75a4325284e67324bcee6b18f882b54">enc_init_phy</a></div><div class="ttdeci">void enc_init_phy(void)</div><div class="ttdoc">initialize the physical interface of ENC28J60 </div><div class="ttdef"><b>Definition:</b> <a href="enc28j60_8c_source.html#l00270">enc28j60.c:270</a></div></div>
<div class="ttc" id="enc28j60_8h_html"><div class="ttname"><a href="enc28j60_8h.html">enc28j60.h</a></div><div class="ttdoc">registers of ENC28J60 device </div></div>
<div class="ttc" id="buffer_8h_html_a05b49c662c073f89e86804f7856622a0"><div class="ttname"><a href="buffer_8h.html#a05b49c662c073f89e86804f7856622a0">LEN</a></div><div class="ttdeci">#define LEN</div><div class="ttdef"><b>Definition:</b> <a href="buffer_8h_source.html#l00033">buffer.h:33</a></div></div>
<div class="ttc" id="main_8c_html_a6821bafc3c88dfb2e433a095df9940c6"><div class="ttname"><a href="main_8c.html#a6821bafc3c88dfb2e433a095df9940c6">BUF_SIZE</a></div><div class="ttdeci">#define BUF_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00043">main.c:43</a></div></div>
<div class="ttc" id="main_8c_html_a74796ad69e9a5ee4a0448582ba5b1bb7"><div class="ttname"><a href="main_8c.html#a74796ad69e9a5ee4a0448582ba5b1bb7">freq</a></div><div class="ttdeci">volatile float freq</div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00055">main.c:55</a></div></div>
<div class="ttc" id="icp_8c_html_a9aea3198ad5628ffd740d6dc46d0f640"><div class="ttname"><a href="icp_8c.html#a9aea3198ad5628ffd740d6dc46d0f640">icp_init</a></div><div class="ttdeci">void icp_init(void(*call_back)(uint16_t))</div><div class="ttdoc">initialize the input capture pin on timer 1 </div><div class="ttdef"><b>Definition:</b> <a href="icp_8c_source.html#l00036">icp.c:36</a></div></div>
<div class="ttc" id="buffer_8c_html_ae4a17adb1fbf755574c338b7d17a68e6"><div class="ttname"><a href="buffer_8c.html#ae4a17adb1fbf755574c338b7d17a68e6">buffer_init</a></div><div class="ttdeci">void buffer_init(void)</div><div class="ttdoc">initialize the ring buffer </div><div class="ttdef"><b>Definition:</b> <a href="buffer_8c_source.html#l00033">buffer.c:33</a></div></div>
<div class="ttc" id="net_8h_html_a94a24147ac9e4282e3dc3109916eceee"><div class="ttname"><a href="net_8h.html#a94a24147ac9e4282e3dc3109916eceee">IP_PROTO_P</a></div><div class="ttdeci">#define IP_PROTO_P</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00128">net.h:128</a></div></div>
<div class="ttc" id="main_8c_html_ae0177d7710b28f95720d54e2b1d37d65"><div class="ttname"><a href="main_8c.html#ae0177d7710b28f95720d54e2b1d37d65">mymac</a></div><div class="ttdeci">uint8_t mymac[6]</div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00047">main.c:47</a></div></div>
<div class="ttc" id="main_8c_html_a602b7b139bc6244cb09fedcdbb06e85e"><div class="ttname"><a href="main_8c.html#a602b7b139bc6244cb09fedcdbb06e85e">snd</a></div><div class="ttdeci">volatile int snd</div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00057">main.c:57</a></div></div>
<div class="ttc" id="main_8c_html_ace59d817931830cd94f04ac3f853bb76"><div class="ttname"><a href="main_8c.html#ace59d817931830cd94f04ac3f853bb76">diff</a></div><div class="ttdeci">volatile uint16_t diff</div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00054">main.c:54</a></div></div>
<div class="ttc" id="atmega16_8h_html_a43bafb28b29491ec7f871319b5a3b2f8"><div class="ttname"><a href="atmega16_8h.html#a43bafb28b29491ec7f871319b5a3b2f8">F_CPU</a></div><div class="ttdeci">#define F_CPU</div><div class="ttdef"><b>Definition:</b> <a href="atmega16_8h_source.html#l00042">atmega16.h:42</a></div></div>
<div class="ttc" id="leds_8c_html_a15aeb6fd48b8cbb5fb0c0380f88fa676"><div class="ttname"><a href="leds_8c.html#a15aeb6fd48b8cbb5fb0c0380f88fa676">led_toggle</a></div><div class="ttdeci">void led_toggle(uint8_t led)</div><div class="ttdoc">toggle a led </div><div class="ttdef"><b>Definition:</b> <a href="leds_8c_source.html#l00106">leds.c:106</a></div></div>
<div class="ttc" id="enc28j60_8h_html_a955683da076de3f92da57d7d06951ae7"><div class="ttname"><a href="enc28j60_8h.html#a955683da076de3f92da57d7d06951ae7">enc_recv_packet</a></div><div class="ttdeci">uint16_t enc_recv_packet(uint16_t, uint8_t *)</div><div class="ttdoc">receive a packet from ethernet </div><div class="ttdef"><b>Definition:</b> <a href="enc28j60_8c_source.html#l00368">enc28j60.c:368</a></div></div>
<div class="ttc" id="main_8c_html_a60983d0ff040975723414a8f21375c77"><div class="ttname"><a href="main_8c.html#a60983d0ff040975723414a8f21375c77">myip</a></div><div class="ttdeci">uint8_t myip[4]</div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00048">main.c:48</a></div></div>
<div class="ttc" id="main_8c_html_a2a1db0f1bf946876695219e06137df07"><div class="ttname"><a href="main_8c.html#a2a1db0f1bf946876695219e06137df07">myport</a></div><div class="ttdeci">uint16_t myport</div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00049">main.c:49</a></div></div>
<div class="ttc" id="net_8h_html_af197bd006505ea01b4cafbf596916af7"><div class="ttname"><a href="net_8h.html#af197bd006505ea01b4cafbf596916af7">IP_PROTO_UDP_V</a></div><div class="ttdeci">#define IP_PROTO_UDP_V</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00132">net.h:132</a></div></div>
<div class="ttc" id="net_8h_html_a7759a689bdd28850817c7de8869d35c4"><div class="ttname"><a href="net_8h.html#a7759a689bdd28850817c7de8869d35c4">ICMP_REQUEST_V</a></div><div class="ttdeci">#define ICMP_REQUEST_V</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00157">net.h:157</a></div></div>
<div class="ttc" id="buffer_8h_html"><div class="ttname"><a href="buffer_8h.html">buffer.h</a></div><div class="ttdoc">header file for ring buffer </div></div>
<div class="ttc" id="net_8c_html_af0b4a02ade3a716c6b10ce1fc821770b"><div class="ttname"><a href="net_8c.html#af0b4a02ade3a716c6b10ce1fc821770b">eth_ip</a></div><div class="ttdeci">uint8_t eth_ip(uint8_t *buf, uint8_t len)</div><div class="ttdoc">make the network communication with ip address </div><div class="ttdef"><b>Definition:</b> <a href="net_8c_source.html#l00097">net.c:97</a></div></div>
<div class="ttc" id="main_8c_html_ae4e727681d08ae8c9618bb026716a532"><div class="ttname"><a href="main_8c.html#ae4e727681d08ae8c9618bb026716a532">old</a></div><div class="ttdeci">volatile uint16_t old</div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00053">main.c:53</a></div></div>
<div class="ttc" id="common_8h_html"><div class="ttname"><a href="common_8h.html">common.h</a></div><div class="ttdoc">some useful definitions </div></div>
<div class="ttc" id="net_8c_html_ad8c59c931bff8fe806ce7598efb6047c"><div class="ttname"><a href="net_8c.html#ad8c59c931bff8fe806ce7598efb6047c">arp_answer</a></div><div class="ttdeci">void arp_answer(uint8_t *buf, uint8_t len)</div><div class="ttdoc">make an answer if request </div><div class="ttdef"><b>Definition:</b> <a href="net_8c_source.html#l00125">net.c:125</a></div></div>
<div class="ttc" id="net_8h_html_a5ac4d574d1b2e5119c7ab8c2b74be434"><div class="ttname"><a href="net_8h.html#a5ac4d574d1b2e5119c7ab8c2b74be434">IP_PROTO_ICMP_V</a></div><div class="ttdeci">#define IP_PROTO_ICMP_V</div><div class="ttdef"><b>Definition:</b> <a href="net_8h_source.html#l00130">net.h:130</a></div></div>
<div class="ttc" id="main_8c_html_aef549d19c508d258c21e95059b300d13"><div class="ttname"><a href="main_8c.html#aef549d19c508d258c21e95059b300d13">buf</a></div><div class="ttdeci">static uint8_t buf[BUF_SIZE]</div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00045">main.c:45</a></div></div>
<div class="ttc" id="net_8c_html_a26c789f4ef67752529324ebba5ac51a1"><div class="ttname"><a href="net_8c.html#a26c789f4ef67752529324ebba5ac51a1">udp_reply</a></div><div class="ttdeci">void udp_reply(uint8_t *buf, char *data, uint8_t len, uint16_t port)</div><div class="ttdoc">make the UDP protocol </div><div class="ttdef"><b>Definition:</b> <a href="net_8c_source.html#l00182">net.c:182</a></div></div>
<div class="ttc" id="freq_8h_html"><div class="ttname"><a href="freq_8h.html">freq.h</a></div><div class="ttdoc">pin locations for "Frequenzmessung-Board" </div></div>
<div class="ttc" id="leds_8h_html"><div class="ttname"><a href="leds_8h.html">leds.h</a></div><div class="ttdoc">specific header file for leds driver </div></div>
<div class="ttc" id="main_8c_html_a1ec087735cb1d1e6da0c0a04fff747ba"><div class="ttname"><a href="main_8c.html#a1ec087735cb1d1e6da0c0a04fff747ba">plen</a></div><div class="ttdeci">volatile uint16_t plen</div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00051">main.c:51</a></div></div>
<div class="ttc" id="main_8c_html_a840291bc02cba5474a4cb46a9b9566fe"><div class="ttname"><a href="main_8c.html#a840291bc02cba5474a4cb46a9b9566fe">main</a></div><div class="ttdeci">int main(void)</div><div class="ttdoc">main function (program start) </div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00089">main.c:89</a></div></div>
<div class="ttc" id="common_8h_html_aa8cecfc5c5c054d2875c03e77b7be15d"><div class="ttname"><a href="common_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a></div><div class="ttdeci">#define TRUE</div><div class="ttdef"><b>Definition:</b> <a href="common_8h_source.html#l00055">common.h:55</a></div></div>
<div class="ttc" id="icp_8h_html"><div class="ttname"><a href="icp_8h.html">icp.h</a></div><div class="ttdoc">header file for input capture pin operations </div></div>
<div class="ttc" id="net_8c_html_a4f72e5a5ef17368554a9b5368d05b5bd"><div class="ttname"><a href="net_8c.html#a4f72e5a5ef17368554a9b5368d05b5bd">echo_reply</a></div><div class="ttdeci">void echo_reply(uint8_t *buf, uint8_t len)</div><div class="ttdoc">make an echo answer (ping - pong) if request </div><div class="ttdef"><b>Definition:</b> <a href="net_8c_source.html#l00158">net.c:158</a></div></div>
<div class="ttc" id="enc28j60_8h_html_a9c0a8d055c8531d4ca1aa8e691acf70a"><div class="ttname"><a href="enc28j60_8h.html#a9c0a8d055c8531d4ca1aa8e691acf70a">enc_init</a></div><div class="ttdeci">void enc_init(uint8_t *)</div></div>
<div class="ttc" id="main_8c_html_aedb0558a93e7ad957d3186ba04578ca0"><div class="ttname"><a href="main_8c.html#aedb0558a93e7ad957d3186ba04578ca0">trigger</a></div><div class="ttdeci">void trigger(uint16_t icr)</div><div class="ttdoc">return-function from input capture interrupt routine </div><div class="ttdef"><b>Definition:</b> <a href="main_8c_source.html#l00065">main.c:65</a></div></div>
<div class="ttc" id="net_8c_html_a2e5cb2f2e4db612d3ac1262da515f20f"><div class="ttname"><a href="net_8c.html#a2e5cb2f2e4db612d3ac1262da515f20f">eth_arp</a></div><div class="ttdeci">uint8_t eth_arp(uint8_t *buf, uint8_t len)</div><div class="ttdoc">make the network wirh arp </div><div class="ttdef"><b>Definition:</b> <a href="net_8c_source.html#l00067">net.c:67</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="main_8c.html">main.c</a></li>
    <li class="footer">Generated on Fri Jun 27 2014 13:38:29 for Bachelorarbeit: Frequenzmessung by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.7 </li>
  </ul>
</div>
</body>
</html>
